<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InsightAtlas - Authentication</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #ffd166;
            --dark-bg: #121212;
            --dark-card: #1e1e1e;
            --dark-text: #f1f5f9;
            --light-bg: #f8fafc;
            --light-card: #ffffff;
            --light-text: #1e293b;
            --accent: #ff6b6b;
            --premium: #ffb700;
            --gray: #94a3b8;
            --success: #06d6a0;
            --warning: #ffd166;
            --danger: #ef476f;
            --gold: #ffb700;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --border-radius: 12px;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: var(--dark-text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .auth-container {
            width: 100%;
            max-width: 450px;
            background-color: var(--dark-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .auth-header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }
        
        .logo-text {
            font-size: 32px;
            font-weight: bold;
            font-family: 'Montserrat', sans-serif;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .auth-subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .auth-tabs {
            display: flex;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .auth-tab.active {
            background-color: white;
            color: var(--primary);
        }
        
        .auth-content {
            padding: 30px;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray);
        }
        
        .form-control {
            width: 100%;
            padding: 14px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--dark-text);
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            background-color: rgba(67, 97, 238, 0.1);
        }
        
        .password-container {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--gray);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            margin-bottom: 15px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-google {
            background-color: white;
            color: #1e293b;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-google:hover {
            background-color: #f8fafc;
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 20px;
            color: var(--gray);
            font-size: 14px;
        }
        
        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .auth-footer a:hover {
            text-decoration: underline;
        }
        
        .forgot-password {
            display: block;
            text-align: right;
            margin-top: -10px;
            margin-bottom: 20px;
            color: var(--gray);
            font-size: 14px;
            text-decoration: none;
        }
        
        .forgot-password:hover {
            color: var(--primary);
            text-decoration: underline;
        }
        
        .otp-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .otp-input {
            width: 15%;
            height: 50px;
            text-align: center;
            font-size: 20px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--dark-text);
        }
        
        .otp-input:focus {
            border-color: var(--primary);
            outline: none;
            background-color: rgba(67, 97, 238, 0.1);
        }
        
        .resend-otp {
            text-align: center;
            margin-top: 15px;
            color: var(--gray);
            font-size: 14px;
        }
        
        .resend-otp a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .resend-otp a:hover {
            text-decoration: underline;
        }
        
        .back-to-login {
            display: block;
            text-align: center;
            margin-top: 20px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .back-to-login:hover {
            text-decoration: underline;
        }
        
        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .success-message {
            color: var(--success);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .password-strength {
            height: 5px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .strength-meter {
            height: 100%;
            width: 0;
            transition: width 0.3s ease;
        }
        
        .weak { width: 33%; background-color: var(--danger); }
        .medium { width: 66%; background-color: var(--warning); }
        .strong { width: 100%; background-color: var(--success); }
        
        .password-rules {
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }
        
        @media (max-width: 480px) {
            .auth-container {
                max-width: 100%;
            }
            
            .auth-content {
                padding: 20px;
            }
            
            .otp-input {
                width: 14%;
                height: 40px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="auth-container">
        <div class="auth-header">
            <div class="logo-text">InsightAtlas</div>
            <div class="auth-subtitle">Unlock the reality of life through knowledge</div>
        </div>
        
        <div class="auth-tabs">
            <div class="auth-tab active" data-tab="login">Login</div>
            <div class="auth-tab" data-tab="signup">Sign Up</div>
        </div>
        
        <div class="auth-content">
            <!-- Login Form -->
            <form class="auth-form active" id="login-form">
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" class="form-control" placeholder="Enter your username">
                    <div class="error-message" id="login-username-error">Please enter your username</div>
                </div>
                
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <div class="password-container">
                        <input type="password" id="login-password" class="form-control" placeholder="Enter your password">
                        <i class="toggle-password fas fa-eye" data-target="login-password"></i>
                    </div>
                    <div class="error-message" id="login-password-error">Please enter your password</div>
                    <a href="#" class="forgot-password" id="forgot-password-link">Forgot password?</a>
                </div>
                
                <button type="submit" class="btn btn-primary">Login to Your Account</button>
                
                <div class="auth-footer">
                    Don't have an account? <a href="#" id="signup-link">Sign up now</a>
                </div>
            </form>
            
            <!-- Sign Up Form -->
            <form class="auth-form" id="signup-form">
                <div class="form-group">
                    <label for="signup-email">Email Address</label>
                    <input type="email" id="signup-email" class="form-control" placeholder="Enter your email">
                    <div class="error-message" id="signup-email-error">Please enter a valid email address</div>
                </div>
                
                <div class="form-group">
                    <label for="signup-username">Username</label>
                    <input type="text" id="signup-username" class="form-control" placeholder="Create a unique username">
                    <div class="error-message" id="signup-username-error">Username must be at least 4 characters</div>
                    <div class="success-message" id="signup-username-available">Username available!</div>
                </div>
                
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <div class="password-container">
                        <input type="password" id="signup-password" class="form-control" placeholder="Create a strong password">
                        <i class="toggle-password fas fa-eye" data-target="signup-password"></i>
                    </div>
                    <div class="password-strength">
                        <div class="strength-meter" id="password-strength-meter"></div>
                    </div>
                    <div class="password-rules">
                        Must be at least 8 characters with a number and special character
                    </div>
                    <div class="error-message" id="signup-password-error">Password is not strong enough</div>
                </div>
                
                <div class="form-group">
                    <label for="signup-confirm-password">Confirm Password</label>
                    <div class="password-container">
                        <input type="password" id="signup-confirm-password" class="form-control" placeholder="Confirm your password">
                        <i class="toggle-password fas fa-eye" data-target="signup-confirm-password"></i>
                    </div>
                    <div class="error-message" id="signup-confirm-password-error">Passwords do not match</div>
                </div>
                
                <button type="submit" class="btn btn-primary">Create Account</button>
                
                <div class="auth-footer">
                    Already have an account? <a href="#" id="login-link">Login here</a>
                </div>
            </form>
            
            <!-- Forgot Password Form -->
            <form class="auth-form" id="forgot-password-form">
                <div class="form-group">
                    <label for="reset-email">Email Address</label>
                    <input type="email" id="reset-email" class="form-control" placeholder="Enter your registered email">
                    <div class="error-message" id="reset-email-error">Please enter your registered email</div>
                    <div class="success-message" id="reset-email-success">OTP has been sent to your email!</div>
                </div>
                
                <button type="submit" class="btn btn-primary">Send OTP</button>
                
                <div class="back-to-login" id="back-to-login">Back to login</div>
            </form>
            
            <!-- OTP Verification Form -->
            <form class="auth-form" id="otp-form">
                <div class="form-group">
                    <label>Enter 6-digit OTP sent to your email</label>
                    <div class="otp-container">
                        <input type="text" class="otp-input" maxlength="1" data-index="1">
                        <input type="text" class="otp-input" maxlength="1" data-index="2">
                        <input type="text" class="otp-input" maxlength="1" data-index="3">
                        <input type="text" class="otp-input" maxlength="1" data-index="4">
                        <input type="text" class="otp-input" maxlength="1" data-index="5">
                        <input type="text" class="otp-input" maxlength="1" data-index="6">
                    </div>
                    <div class="error-message" id="otp-error">Invalid OTP. Please try again.</div>
                    <div class="resend-otp">
                        Didn't receive OTP? <a href="#" id="resend-otp">Resend OTP</a>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">Verify OTP</button>
                
                <div class="back-to-login" id="back-to-login-otp">Back to login</div>
            </form>
            
            <!-- Reset Password Form -->
            <form class="auth-form" id="reset-password-form">
                <div class="form-group">
                    <label for="new-password">New Password</label>
                    <div class="password-container">
                        <input type="password" id="new-password" class="form-control" placeholder="Create a new password">
                        <i class="toggle-password fas fa-eye" data-target="new-password"></i>
                    </div>
                    <div class="password-strength">
                        <div class="strength-meter" id="new-password-strength-meter"></div>
                    </div>
                    <div class="password-rules">
                        Must be at least 8 characters with a number and special character
                    </div>
                    <div class="error-message" id="new-password-error">Password is not strong enough</div>
                </div>
                
                <div class="form-group">
                    <label for="confirm-new-password">Confirm New Password</label>
                    <div class="password-container">
                        <input type="password" id="confirm-new-password" class="form-control" placeholder="Confirm your new password">
                        <i class="toggle-password fas fa-eye" data-target="confirm-new-password"></i>
                    </div>
                    <div class="error-message" id="confirm-new-password-error">Passwords do not match</div>
                </div>
                
                <button type="submit" class="btn btn-primary">Reset Password</button>
                
                <div class="back-to-login" id="back-to-login-reset">Back to login</div>
            </form>
        </div>
    </div>

    <script>
        // DOM Elements
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const forgotPasswordForm = document.getElementById('forgot-password-form');
        const otpForm = document.getElementById('otp-form');
        const resetPasswordForm = document.getElementById('reset-password-form');
        const togglePasswordIcons = document.querySelectorAll('.toggle-password');
        const signupLink = document.getElementById('signup-link');
        const loginLink = document.getElementById('login-link');
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const backToLoginLinks = document.querySelectorAll('.back-to-login');
        const resendOtpLink = document.getElementById('resend-otp');
        
        // User accounts storage (localStorage)
        const USER_ACCOUNTS_KEY = 'insightAtlasAccounts';
        let userAccounts = JSON.parse(localStorage.getItem(USER_ACCOUNTS_KEY)) || [];
        
        // OTP storage
        let generatedOtp = null;
        let otpExpiration = null;
        
        // Password strength function
        function checkPasswordStrength(password) {
            let strength = 0;
            if (password.length >= 8) strength += 1;
            if (/[A-Z]/.test(password)) strength += 1;
            if (/[0-9]/.test(password)) strength += 1;
            if (/[^A-Za-z0-9]/.test(password)) strength += 1;
            
            return strength;
        }
        
        // Update password strength meter
        function updatePasswordStrength(password, meterId) {
            const strength = checkPasswordStrength(password);
            const meter = document.getElementById(meterId);
            meter.className = 'strength-meter';
            
            if (password.length === 0) {
                meter.style.width = '0';
                return;
            }
            
            if (strength < 2) {
                meter.classList.add('weak');
            } else if (strength < 4) {
                meter.classList.add('medium');
            } else {
                meter.classList.add('strong');
            }
        }
        
        // Generate a 6-digit OTP
        function generateOtp() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }
        
        // Send OTP to email (simulated)
        function sendOtpToEmail(email) {
            generatedOtp = generateOtp();
            otpExpiration = Date.now() + 300000; // 5 minutes expiration
            
            // In a real app, you would send the OTP to the user's email
            // For this demo, we'll just log it and show a success message
            console.log(`OTP for ${email}: ${generatedOtp}`);
            
            // Show success message
            document.getElementById('reset-email-success').style.display = 'block';
            
            // Simulate sending
            setTimeout(() => {
                alert(`OTP sent to ${email}: ${generatedOtp}\n\nIn a real app, this would be sent via email.`);
            }, 500);
        }
        
        // Verify OTP
        function verifyOtp(otp) {
            if (!generatedOtp || !otpExpiration) {
                return false;
            }
            
            if (Date.now() > otpExpiration) {
                return false;
            }
            
            return otp === generatedOtp;
        }
        
        // Switch between auth forms
        function showForm(formId) {
            authForms.forEach(form => {
                form.classList.remove('active');
                if (form.id === formId) {
                    form.classList.add('active');
                }
            });
        }
        
        // Toggle password visibility
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const icon = document.querySelector(`.toggle-password[data-target="${inputId}"]`);
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        // Handle OTP input navigation
        function handleOtpInput(e) {
            const input = e.target;
            const index = parseInt(input.dataset.index);
            
            if (e.inputType === 'deleteContentBackward' && input.value === '') {
                if (index > 1) {
                    const prevInput = document.querySelector(`.otp-input[data-index="${index - 1}"]`);
                    prevInput.focus();
                }
                return;
            }
            
            if (input.value.length === 1 && index < 6) {
                const nextInput = document.querySelector(`.otp-input[data-index="${index + 1}"]`);
                nextInput.focus();
            }
        }
        
        // Get full OTP from inputs
        function getFullOtp() {
            let otp = '';
            for (let i = 1; i <= 6; i++) {
                const input = document.querySelector(`.otp-input[data-index="${i}"]`);
                otp += input.value;
            }
            return otp;
        }
        
        // Validate email format
        function isValidEmail(email) {
            const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        }
        
        // Check if username is available
        function isUsernameAvailable(username) {
            return !userAccounts.some(account => account.username === username);
        }
        
        // Event Listeners
        authTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab;
                
                authTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                if (tabId === 'login') {
                    showForm('login-form');
                } else if (tabId === 'signup') {
                    showForm('signup-form');
                }
            });
        });
        
        signupLink.addEventListener('click', (e) => {
            e.preventDefault();
            authTabs.forEach(tab => tab.classList.remove('active'));
            document.querySelector('.auth-tab[data-tab="signup"]').classList.add('active');
            showForm('signup-form');
        });
        
        loginLink.addEventListener('click', (e) => {
            e.preventDefault();
            authTabs.forEach(tab => tab.classList.remove('active'));
            document.querySelector('.auth-tab[data-tab="login"]').classList.add('active');
            showForm('login-form');
        });
        
        forgotPasswordLink.addEventListener('click', (e) => {
            e.preventDefault();
            showForm('forgot-password-form');
        });
        
        backToLoginLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                authTabs.forEach(tab => tab.classList.remove('active'));
                document.querySelector('.auth-tab[data-tab="login"]').classList.add('active');
                showForm('login-form');
            });
        });
        
        resendOtpLink.addEventListener('click', (e) => {
            e.preventDefault();
            const email = document.getElementById('reset-email').value;
            if (isValidEmail(email)) {
                sendOtpToEmail(email);
            }
        });
        
        togglePasswordIcons.forEach(icon => {
            icon.addEventListener('click', () => {
                const target = icon.dataset.target;
                togglePasswordVisibility(target);
            });
        });
        
        document.querySelectorAll('.otp-input').forEach(input => {
            input.addEventListener('input', handleOtpInput);
        });
        
        // Password strength indicators
        document.getElementById('signup-password').addEventListener('input', function() {
            updatePasswordStrength(this.value, 'password-strength-meter');
        });
        
        document.getElementById('new-password').addEventListener('input', function() {
            updatePasswordStrength(this.value, 'new-password-strength-meter');
        });
        
        // Username availability check
        document.getElementById('signup-username').addEventListener('input', function() {
            const username = this.value;
            const errorElement = document.getElementById('signup-username-error');
            const successElement = document.getElementById('signup-username-available');
            
            if (username.length < 4) {
                errorElement.textContent = 'Username must be at least 4 characters';
                errorElement.style.display = 'block';
                successElement.style.display = 'none';
                return;
            }
            
            if (!isUsernameAvailable(username)) {
                errorElement.textContent = 'Username is already taken';
                errorElement.style.display = 'block';
                successElement.style.display = 'none';
            } else {
                errorElement.style.display = 'none';
                successElement.style.display = 'block';
            }
        });
        
        // Form submissions
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            let isValid = true;
            
            // Reset errors
            document.getElementById('login-username-error').style.display = 'none';
            document.getElementById('login-password-error').style.display = 'none';
            
            // Validate username
            if (!username) {
                document.getElementById('login-username-error').style.display = 'block';
                isValid = false;
            }
            
            // Validate password
            if (!password) {
                document.getElementById('login-password-error').style.display = 'block';
                isValid = false;
            }
            
            if (isValid) {
                // Find user account
                const user = userAccounts.find(account => 
                    account.username === username && account.password === password);
                
                if (user) {
                    alert('Login successful! Redirecting to the app...');
                    // In a real app, you would redirect to the main app page
                    // window.location.href = 'app.html';
                } else {
                    document.getElementById('login-password-error').textContent = 'Invalid username or password';
                    document.getElementById('login-password-error').style.display = 'block';
                }
            }
        });
        
        signupForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('signup-email').value;
            const username = document.getElementById('signup-username').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;
            let isValid = true;
            
            // Reset errors
            document.getElementById('signup-email-error').style.display = 'none';
            document.getElementById('signup-username-error').style.display = 'none';
            document.getElementById('signup-password-error').style.display = 'none';
            document.getElementById('signup-confirm-password-error').style.display = 'none';
            
            // Validate email
            if (!isValidEmail(email)) {
                document.getElementById('signup-email-error').style.display = 'block';
                isValid = false;
            }
            
            // Validate username
            if (username.length < 4) {
                document.getElementById('signup-username-error').textContent = 'Username must be at least 4 characters';
                document.getElementById('signup-username-error').style.display = 'block';
                isValid = false;
            } else if (!isUsernameAvailable(username)) {
                document.getElementById('signup-username-error').textContent = 'Username is already taken';
                document.getElementById('signup-username-error').style.display = 'block';
                isValid = false;
            }
            
            // Validate password
            const strength = checkPasswordStrength(password);
            if (strength < 3) {
                document.getElementById('signup-password-error').style.display = 'block';
                isValid = false;
            }
            
            // Validate password match
            if (password !== confirmPassword) {
                document.getElementById('signup-confirm-password-error').style.display = 'block';
                isValid = false;
            }
            
            if (isValid) {
                // Create new account
                const newAccount = {
                    email,
                    username,
                    password
                };
                
                // Save to localStorage
                userAccounts.push(newAccount);
                localStorage.setItem(USER_ACCOUNTS_KEY, JSON.stringify(userAccounts));
                
                alert('Account created successfully! You can now login.');
                
                // Switch to login form
                authTabs.forEach(tab => tab.classList.remove('active'));
                document.querySelector('.auth-tab[data-tab="login"]').classList.add('active');
                showForm('login-form');
                
                // Clear form
                signupForm.reset();
                document.getElementById('signup-username-available').style.display = 'none';
                document.getElementById('password-strength-meter').style.width = '0';
            }
        });
        
        forgotPasswordForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('reset-email').value;
            
            // Reset messages
            document.getElementById('reset-email-error').style.display = 'none';
            document.getElementById('reset-email-success').style.display = 'none';
            
            // Validate email
            if (!isValidEmail(email)) {
                document.getElementById('reset-email-error').style.display = 'block';
                return;
            }
            
            // Check if email exists
            const userExists = userAccounts.some(account => account.email === email);
            if (!userExists) {
                document.getElementById('reset-email-error').textContent = 'Email not found in our system';
                document.getElementById('reset-email-error').style.display = 'block';
                return;
            }
            
            // Send OTP
            sendOtpToEmail(email);
            showForm('otp-form');
        });
        
        otpForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const otp = getFullOtp();
            
            // Reset error
            document.getElementById('otp-error').style.display = 'none';
            
            // Verify OTP
            if (verifyOtp(otp)) {
                showForm('reset-password-form');
            } else {
                document.getElementById('otp-error').style.display = 'block';
            }
        });
        
        resetPasswordForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-new-password').value;
            let isValid = true;
            
            // Reset errors
            document.getElementById('new-password-error').style.display = 'none';
            document.getElementById('confirm-new-password-error').style.display = 'none';
            
            // Validate password strength
            const strength = checkPasswordStrength(newPassword);
            if (strength < 3) {
                document.getElementById('new-password-error').style.display = 'block';
                isValid = false;
            }
            
            // Validate password match
            if (newPassword !== confirmPassword) {
                document.getElementById('confirm-new-password-error').style.display = 'block';
                isValid = false;
            }
            
            if (isValid) {
                // Get email from reset form
                const email = document.getElementById('reset-email').value;
                
                // Update password in accounts
                const accountIndex = userAccounts.findIndex(account => account.email === email);
                if (accountIndex !== -1) {
                    userAccounts[accountIndex].password = newPassword;
                    localStorage.setItem(USER_ACCOUNTS_KEY, JSON.stringify(userAccounts));
                    
                    alert('Password reset successfully! You can now login with your new password.');
                    
                    // Switch to login form
                    authTabs.forEach(tab => tab.classList.remove('active'));
                    document.querySelector('.auth-tab[data-tab="login"]').classList.add('active');
                    showForm('login-form');
                    
                    // Clear forms
                    forgotPasswordForm.reset();
                    resetPasswordForm.reset();
                    
                    // Reset OTP
                    generatedOtp = null;
                    otpExpiration = null;
                    
                    // Clear OTP inputs
                    document.querySelectorAll('.otp-input').forEach(input => input.value = '');
                }
            }
        });
    </script>
</body>
</html>
