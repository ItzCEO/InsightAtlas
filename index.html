// src/App.js
import React, { useState, useEffect, createContext, useContext } from 'react';
import ReactDOM from 'react-dom/client';

// ======================
// Contexts and Providers
// ======================

// Auth Context
const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const storedUser = localStorage.getItem('user');
    if (storedUser) {
      setUser(JSON.parse(storedUser));
    }
    setLoading(false);
  }, []);

  const login = (username) => {
    const userData = { username, id: Date.now().toString() };
    localStorage.setItem('user', JSON.stringify(userData));
    setUser(userData);
    return userData;
  };

  const signup = (username, password) => {
    const userData = { username, id: Date.now().toString() };
    localStorage.setItem('user', JSON.stringify(userData));
    setUser(userData);
    return userData;
  };

  const logout = () => {
    localStorage.removeItem('user');
    setUser(null);
  };

  return (
    <AuthContext.Provider value={{ user, login, signup, logout, loading }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => useContext(AuthContext);

// Theme Context
const ThemeContext = createContext();

export const ThemeProvider = ({ children }) => {
  const [darkMode, setDarkMode] = useState(false);

  useEffect(() => {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      setDarkMode(savedTheme === 'dark');
    }
  }, []);

  const toggleTheme = () => {
    const newTheme = !darkMode ? 'dark' : 'light';
    setDarkMode(!darkMode);
    localStorage.setItem('theme', newTheme);
  };

  return (
    <ThemeContext.Provider value={{ darkMode, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
};

export const useTheme = () => useContext(ThemeContext);

// ======================
// Custom Hooks
// ======================

// Session Management Hook
export const useSession = () => {
  const navigate = useNavigate();
  const { logout } = useAuth();
  let logoutTimer;

  const resetTimer = () => {
    clearTimeout(logoutTimer);
    logoutTimer = setTimeout(() => {
      logout();
      navigate('/login');
    }, 30 * 60 * 1000); // 30 minutes
  };

  useEffect(() => {
    const events = ['mousedown', 'keydown', 'scroll', 'touchstart'];
    events.forEach(event => {
      window.addEventListener(event, resetTimer);
    });

    resetTimer();

    return () => {
      clearTimeout(logoutTimer);
      events.forEach(event => {
        window.removeEventListener(event, resetTimer);
      });
    };
  }, []);
};

// Security Hook
export const useSecurity = () => {
  useEffect(() => {
    const handleContextMenu = (e) => {
      if (process.env.NODE_ENV === 'production') {
        e.preventDefault();
      }
    };

    const handleCopy = (e) => {
      if (process.env.NODE_ENV === 'production') {
        e.preventDefault();
      }
    };

    const handleVisibilityChange = () => {
      if (document.hidden) {
        console.warn('Screen recording might be in progress');
      }
    };

    document.addEventListener('contextmenu', handleContextMenu);
    document.addEventListener('copy', handleCopy);
    document.addEventListener('visibilitychange', handleVisibilityChange);

    return () => {
      document.removeEventListener('contextmenu', handleContextMenu);
      document.removeEventListener('copy', handleCopy);
      document.removeEventListener('visibilitychange', handleVisibilityChange);
    };
  }, []);
};

// ======================
// Components
// ======================

// Header Component
const Header = () => {
  const { darkMode, toggleTheme } = useTheme();
  const { user, logout } = useAuth();
  const navigate = useNavigate();

  return (
    <header className={`py-4 ${darkMode ? 'bg-gray-800' : 'bg-blue-600'}`}>
      <div className="container mx-auto px-4 flex justify-between items-center">
        <div className="flex items-center cursor-pointer" onClick={() => navigate('/')}>
          <div className="bg-gray-200 border-2 border-dashed rounded-xl w-16 h-16" />
          <h1 className={`ml-4 text-2xl font-bold ${darkMode ? 'text-white' : 'text-white'}`}>
            InsightAtlas
          </h1>
        </div>
        
        <div className="flex items-center space-x-4">
          {user ? (
            <>
              <button 
                onClick={() => navigate('/dashboard')}
                className={`px-4 py-2 rounded-lg ${
                  darkMode ? 'bg-gray-700 text-white' : 'bg-white text-blue-600'
                }`}
              >
                Dashboard
              </button>
              <button 
                onClick={logout}
                className={`px-4 py-2 rounded-lg ${
                  darkMode ? 'bg-gray-700 text-white' : 'bg-white text-blue-600'
                }`}
              >
                Logout
              </button>
            </>
          ) : (
            <>
              <button 
                onClick={() => navigate('/login')}
                className={`px-4 py-2 rounded-lg ${
                  darkMode ? 'bg-gray-700 text-white' : 'bg-white text-blue-600'
                }`}
              >
                Login
              </button>
              <button 
                onClick={() => navigate('/signup')}
                className={`px-4 py-2 rounded-lg ${
                  darkMode ? 'bg-gray-700 text-white' : 'bg-white text-blue-600'
                }`}
              >
                Sign Up
              </button>
            </>
          )}
          <button 
            onClick={toggleTheme}
            className={`p-2 rounded-full ${
              darkMode ? 'bg-gray-700 text-yellow-400' : 'bg-gray-200 text-gray-700'
            }`}
          >
            {darkMode ? '‚òÄÔ∏è' : 'üåô'}
          </button>
        </div>
      </div>
    </header>
  );
};

// Book Card Component
const BookCard = ({ book }) => {
  const { darkMode } = useTheme();
  const navigate = useNavigate();

  return (
    <div className={`rounded-xl shadow-md overflow-hidden transition-transform hover:scale-105 ${
      darkMode ? 'bg-gray-800' : 'bg-white'
    }`}>
      <div className="flex">
        <div className="w-1/3">
          <div className="bg-gray-200 border-2 border-dashed rounded-xl w-full h-48" />
        </div>
        
        <div className="w-2/3 p-4">
          <h3 className={`font-bold text-lg ${darkMode ? 'text-white' : 'text-black'}`}>
            {book.title}
          </h3>
          <p className={`text-sm mt-1 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
            By {book.author}
          </p>
          
          <div className="mt-4">
            {book.isFree ? (
              <span className="bg-yellow-500 text-white px-3 py-1 rounded-full text-xs font-medium">
                Free Access
              </span>
            ) : (
              <span className="bg-purple-600 text-white px-3 py-1 rounded-full text-xs font-medium">
                Premium
              </span>
            )}
          </div>
          
          <div className="mt-4">
            <button
              onClick={() => navigate(`/book/${book.id}`)}
              className="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors"
            >
              Read Now
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

// Book List Component
const BookList = ({ books }) => {
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {books.map(book => (
        <BookCard key={book.id} book={book} />
      ))}
    </div>
  );
};

// Help Assistant Component
const HelpAssistant = () => {
  const { darkMode } = useTheme();
  const [messages, setMessages] = useState([
    { text: "Hello! I'm your InsightAtlas assistant. How can I help you today?", sender: 'ai' }
  ]);
  const [input, setInput] = useState('');
  const messagesEndRef = useRef(null);
  
  const commonQuestions = [
    "How do I purchase a book?",
    "How do I read offline?",
    "How do I change my password?",
    "I have a payment issue",
    "Contact support"
  ];

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!input.trim()) return;
    
    // Add user message
    const userMessage = { text: input, sender: 'user' };
    setMessages(prev => [...prev, userMessage]);
    setInput('');
    
    // Simulate AI response after a delay
    setTimeout(() => {
      let response = "I'm here to help. Could you please provide more details?";
      
      if (input.toLowerCase().includes('payment') || input.toLowerCase().includes('purchase')) {
        response = "To purchase a book, click the 'Buy Full Access' button on the book page. You'll be guided through the payment process where you'll transfer to our GTBank account. After payment, send the proof to samcreation804@gmail.com with the book name as narration.";
      } 
      else if (input.toLowerCase().includes('offline')) {
        response = "To read offline, go to your Library and click the Download button next to any book you've purchased. Once downloaded, you can read it anytime without an internet connection.";
      }
      else if (input.toLowerCase().includes('password')) {
        response = "You can change your password in Settings > Account Security. If you've forgotten your password, please contact support at samcreation804@gmail.com.";
      }
      else if (input.toLowerCase().includes('contact') || input.toLowerCase().includes('support')) {
        response = "You can contact our support team via email at samcreation804@gmail.com or WhatsApp at 07034969325. We typically respond within 24 hours.";
      }
      
      setMessages(prev => [...prev, { text: response, sender: 'ai' }]);
    }, 1000);
  };

  return (
    <div className={`rounded-xl shadow-md p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
      <h2 className={`text-2xl font-bold mb-6 ${darkMode ? 'text-white' : 'text-black'}`}>
        Help Assistant
      </h2>
      
      <div className={`border rounded-lg overflow-hidden h-[500px] flex flex-col ${
        darkMode ? 'border-gray-700' : 'border-gray-300'
      }`}>
        <div className={`flex-1 overflow-y-auto p-4 ${
          darkMode ? 'bg-gray-900' : 'bg-gray-50'
        }`}>
          {messages.map((msg, i) => (
            <div 
              key={i} 
              className={`mb-4 ${msg.sender === 'user' ? 'text-right' : ''}`}
            >
              <div 
                className={`inline-block p-3 rounded-lg max-w-[80%] ${
                  msg.sender === 'user' 
                    ? 'bg-blue-600 text-white rounded-br-none' 
                    : `${darkMode ? 'bg-gray-700' : 'bg-gray-200'} rounded-bl-none`
                }`}
              >
                {msg.text}
              </div>
            </div>
          ))}
          <div ref={messagesEndRef} />
        </div>
        
        <div className={`border-t p-4 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
          <form onSubmit={handleSubmit} className="flex">
            <input
              type="text"
              value={input}
              onChange={(e) => setInput(e.target.value)}
              placeholder="Ask a question..."
              className={`flex-1 border ${
                darkMode ? 'border-gray-600 bg-gray-700 text-white' : 'border-gray-300'
              } rounded-l-lg p-3 focus:outline-none`}
            />
            <button 
              type="submit" 
              className="bg-blue-600 text-white px-6 rounded-r-lg font-medium"
            >
              Send
            </button>
          </form>
          
          <div className="mt-3">
            <p className={`text-sm mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
              Common questions:
            </p>
            <div className="flex flex-wrap gap-2">
              {commonQuestions.map((q, i) => (
                <button
                  key={i}
                  onClick={() => setInput(q)}
                  className={`text-sm px-3 py-1 rounded-lg ${
                    darkMode 
                      ? 'bg-gray-700 hover:bg-gray-600 text-gray-200' 
                      : 'bg-gray-200 hover:bg-gray-300'
                  }`}
                >
                  {q}
                </button>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// ======================
// Pages
// ======================

// Home Page
const HomePage = () => {
  const { user } = useAuth();
  const { darkMode } = useTheme();
  const [searchTerm, setSearchTerm] = useState('');

  // Mock book data
  const books = [
    {
      id: '1',
      title: 'The Main Reality Of Life',
      author: 'Samuel A.O.',
      coverImage: '/book-covers/main-reality.jpg',
      isFree: false,
      price: 2500,
      description: 'A profound exploration of life\'s deepest truths and illusions',
      freeContent: 'First few chapters...'
    }
  ];

  const filteredBooks = books.filter(book => 
    book.title.toLowerCase().includes(searchTerm.toLowerCase()) || 
    book.author.toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    <div className="container mx-auto px-4 py-8">
      <Header />
      
      <div className="mt-8 mb-6">
        <div className="relative">
          <input
            type="text"
            placeholder="Search books by title or author..."
            className={`w-full p-4 rounded-lg border ${
              darkMode ? 'border-gray-700 bg-gray-800 text-white' : 'border-gray-300 bg-white text-black'
            }`}
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
          <svg 
            className={`absolute right-4 top-4 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`} 
            xmlns="http://www.w3.org/2000/svg" 
            width="24" 
            height="24" 
            viewBox="0 0 24 24"
          >
            <path fill="currentColor" d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3l-1.4 1.4ZM9.5 14q1.875 0 3.188-1.313T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14Z"/>
          </svg>
        </div>
      </div>

      <BookList books={filteredBooks} />
    </div>
  );
};

// Login Page
const LoginPage = () => {
  const { login } = useAuth();
  const { darkMode } = useTheme();
  const navigate = useNavigate();
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    
    if (!username || !password) {
      setError('Please enter both username and password');
      return;
    }
    
    login(username);
    navigate('/');
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <Header />
      
      <div className="max-w-md mx-auto mt-16">
        <div className={`rounded-xl shadow-lg p-8 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
          <h1 className={`text-3xl font-bold mb-8 text-center ${darkMode ? 'text-white' : 'text-black'}`}>
            Sign In to InsightAtlas
          </h1>
          
          {error && (
            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
              {error}
            </div>
          )}
          
          <form onSubmit={handleSubmit}>
            <div className="mb-6">
              <label className={`block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                Username
              </label>
              <input
                type="text"
                value={username}
                onChange={(e) => setUsername(e.target.value)}
                className={`w-full p-3 rounded-lg border ${
                  darkMode ? 'border-gray-700 bg-gray-900 text-white' : 'border-gray-300'
                }`}
                placeholder="Enter your username"
              />
            </div>
            
            <div className="mb-6">
              <label className={`block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                Password
              </label>
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className={`w-full p-3 rounded-lg border ${
                  darkMode ? 'border-gray-700 bg-gray-900 text-white' : 'border-gray-300'
                }`}
                placeholder="Enter your password"
              />
            </div>
            
            <button
              type="submit"
              className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors"
            >
              Sign In
            </button>
            
            <div className="mt-6 text-center">
              <p className={darkMode ? 'text-gray-400' : 'text-gray-600'}>
                Don't have an account?{' '}
                <button 
                  onClick={() => navigate('/signup')}
                  className="text-blue-500 hover:text-blue-700 font-medium"
                >
                  Sign Up
                </button>
              </p>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
};

// Signup Page
const SignupPage = () => {
  const { signup } = useAuth();
  const { darkMode } = useTheme();
  const navigate = useNavigate();
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    
    if (!username || !password) {
      setError('Please enter both username and password');
      return;
    }
    
    if (password !== confirmPassword) {
      setError('Passwords do not match');
      return;
    }
    
    signup(username, password);
    navigate('/');
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <Header />
      
      <div className="max-w-md mx-auto mt-16">
        <div className={`rounded-xl shadow-lg p-8 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
          <h1 className={`text-3xl font-bold mb-8 text-center ${darkMode ? 'text-white' : 'text-black'}`}>
            Create an Account
          </h1>
          
          {error && (
            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
              {error}
            </div>
          )}
          
          <form onSubmit={handleSubmit}>
            <div className="mb-6">
              <label className={`block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                Username
              </label>
              <input
                type="text"
                value={username}
                onChange={(e) => setUsername(e.target.value)}
                className={`w-full p-3 rounded-lg border ${
                  darkMode ? 'border-gray-700 bg-gray-900 text-white' : 'border-gray-300'
                }`}
                placeholder="Choose a username"
              />
            </div>
            
            <div className="mb-6">
              <label className={`block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                Password
              </label>
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className={`w-full p-3 rounded-lg border ${
                  darkMode ? 'border-gray-700 bg-gray-900 text-white' : 'border-gray-300'
                }`}
                placeholder="Create a password"
              />
            </div>
            
            <div className="mb-6">
              <label className={`block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                Confirm Password
              </label>
              <input
                type="password"
                value={confirmPassword}
                onChange={(e) => setConfirmPassword(e.target.value)}
                className={`w-full p-3 rounded-lg border ${
                  darkMode ? 'border-gray-700 bg-gray-900 text-white' : 'border-gray-300'
                }`}
                placeholder="Confirm your password"
              />
            </div>
            
            <button
              type="submit"
              className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors"
            >
              Create Account
            </button>
            
            <div className="mt-6 text-center">
              <p className={darkMode ? 'text-gray-400' : 'text-gray-600'}>
                Already have an account?{' '}
                <button 
                  onClick={() => navigate('/login')}
                  className="text-blue-500 hover:text-blue-700 font-medium"
                >
                  Sign In
                </button>
              </p>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
};

// Book Reader Page
const BookReader = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const { darkMode } = useTheme();
  const { user } = useAuth();
  const [book, setBook] = useState(null);
  const [accessLevel, setAccessLevel] = useState('free');
  const [isOffline, setIsOffline] = useState(!navigator.onLine);

  // Mock book data
  const books = [
    {
      id: '1',
      title: 'The Main Reality Of Life',
      author: 'Samuel A.O.',
      coverImage: '/book-covers/main-reality.jpg',
      isFree: false,
      price: 2500,
      freeContent: `
        <h1 class="text-3xl font-bold mb-4">THE MAIN REALITY OF LIFE</h1>
        <h2 class="text-xl font-semibold mb-8">SAMUEL A.O</h2>
        
        <h3 class="text-lg font-bold mb-4">APPRECIATION</h3>
        <p class="mb-4">Primarily, my endless thanks to God Almighty for seeing me through this journey...</p>
        
        <h3 class="text-xl font-bold mb-4">Chapter 1: The Illusion vs. The Reality</h3>
        <p class="mb-4 italic">"Everyone is chasing something ‚Äî success, love, validation, peace. But few stop to ask: What am I really chasing, and why?"</p>
        
        <p class="mb-4">From the moment we're born, we're introduced to a script, not handed to us directly but absorbed through the voices and expectations of those around us...</p>
      `,
      fullContent: `
        <h1 class="text-3xl font-bold mb-4">THE MAIN REALITY OF LIFE</h1>
        <h2 class="text-xl font-semibold mb-8">SAMUEL A.O</h2>
        
        <h3 class="text-lg font-bold mb-4">APPRECIATION</h3>
        <p class="mb-4">Primarily, my endless thanks to God Almighty for seeing me through this journey...</p>
        
        <h3 class="text-xl font-bold mb-4">Chapter 1: The Illusion vs. The Reality</h3>
        <p class="mb-4 italic">"Everyone is chasing something ‚Äî success, love, validation, peace. But few stop to ask: What am I really chasing, and why?"</p>
        
        <p class="mb-4">From the moment we're born, we're introduced to a script, not handed to us directly but absorbed through the voices and expectations of those around us...</p>
        
        <!-- Full book content would continue here -->
        
        <h3 class="text-xl font-bold mt-8 mb-4">Chapter 10: The Journey Ahead ‚Äî Living Your Main Reality</h3>
        <p class="mb-4">The End is Just the Beginning</p>
        
        <p class="mb-4">As we reach the final chapter of this exploration into The Main Reality Of Life...</p>
        
        <h3 class="text-lg font-bold mt-8 mb-4">ABOUT THE AUTHOR</h3>
        <p class="mb-4">Samuel A.O. is currently a student of Ekiti State University in the department of Statistics...</p>
      `
    }
  ];

  useEffect(() => {
    const foundBook = books.find(b => b.id === id);
    
    if (!foundBook) {
      navigate('/');
      return;
    }
    
    setBook(foundBook);
    
    // Check if user has purchased this book
    const purchasedBooks = JSON.parse(localStorage.getItem('purchasedBooks') || '[]');
    if (purchasedBooks.includes(id)) {
      setAccessLevel('full');
    }
  }, [id, navigate]);

  useEffect(() => {
    const handleOnline = () => setIsOffline(false);
    const handleOffline = () => setIsOffline(true);
    
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  const handlePurchase = () => {
    navigate('/payment');
  };

  if (!book) return <div className="text-center py-12">Loading book...</div>;

  return (
    <div className="container mx-auto px-4 py-8">
      <Header />
      
      <div className="mt-8 max-w-4xl mx-auto">
        {isOffline && (
          <div className="bg-yellow-500 text-black p-4 mb-6 rounded-lg text-center">
            You are offline. Reading from cached version.
          </div>
        )}
        
        <div className="text-center mb-8">
          <div className="bg-gray-200 border-2 border-dashed rounded-xl w-48 h-64 mx-auto" />
          <h1 className={`text-3xl font-bold mt-4 ${darkMode ? 'text-white' : 'text-black'}`}>
            {book.title}
          </h1>
          <p className={`mt-2 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
            By {book.author}
          </p>
        </div>
        
        <div 
          className={`prose max-w-none mb-12 ${darkMode ? 'prose-invert' : ''}`}
          dangerouslySetInnerHTML={{ 
            __html: accessLevel === 'full' ? book.fullContent : book.freeContent 
          }}
        />
        
        {accessLevel === 'free' && (
          <div className={`p-6 rounded-lg text-center mb-12 ${
            darkMode ? 'bg-gray-800' : 'bg-gray-100'
          }`}>
            <h3 className={`text-xl font-bold mb-4 ${darkMode ? 'text-white' : 'text-black'}`}>
              Want to read the full book?
            </h3>
            <button 
              onClick={handlePurchase}
              className="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg transition-colors"
            >
              Buy Full Access - ‚Ç¶2,500
            </button>
          </div>
        )}
      </div>
    </div>
  );
};

// Payment Page
const PaymentPage = () => {
  const navigate = useNavigate();
  const { user } = useAuth();
  const { darkMode } = useTheme();
  const [paymentDetails] = useState({
    bookName: 'The Main Reality Of Life',
    amount: 2500,
    accountNumber: '0863542562',
    accountName: 'Alake Samuel',
    bank: 'GTBank',
    email: 'samcreation804@gmail.com',
    whatsapp: '07034969325'
  });
  const [transactionProof, setTransactionProof] = useState(null);
  const [isSubmitted, setIsSubmitted] = useState(false);

  const handleFileChange = (e) => {
    setTransactionProof(e.target.files[0]);
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    
    // Save purchase locally
    const purchasedBooks = JSON.parse(localStorage.getItem('purchasedBooks') || '[]');
    purchasedBooks.push('1'); // Book ID for "The Main Reality Of Life"
    localStorage.setItem('purchasedBooks', JSON.stringify(purchasedBooks));
    
    setIsSubmitted(true);
    
    // Redirect to book after 3 seconds
    setTimeout(() => {
      navigate('/book/1');
    }, 3000);
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <Header />
      
      <div className="max-w-3xl mx-auto mt-8">
        <h1 className={`text-3xl font-bold text-center mb-8 ${darkMode ? 'text-white' : 'text-black'}`}>
          Complete Your Purchase
        </h1>
        
        {isSubmitted ? (
          <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-6">
            <p className="font-bold">Payment Submitted!</p>
            <p>Your payment proof has been sent for verification. You'll be redirected to the book shortly.</p>
          </div>
        ) : (
          <div className={`rounded-xl shadow-lg p-6 mb-8 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
            <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-white' : 'text-black'}`}>
              Payment Instructions
            </h2>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div className={`border rounded-lg p-4 ${
                darkMode ? 'border-gray-700' : 'border-gray-200'
              }`}>
                <h3 className={`font-semibold mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  Bank Transfer Details
                </h3>
                <p className={`mb-1 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  <span className="font-medium">Bank:</span> {paymentDetails.bank}
                </p>
                <p className={`mb-1 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  <span className="font-medium">Account Name:</span> {paymentDetails.accountName}
                </p>
                <p className={`mb-1 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  <span className="font-medium">Account Number:</span> {paymentDetails.accountNumber}
                </p>
                <p className={`mt-3 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  <span className="font-medium">Amount:</span> ‚Ç¶{paymentDetails.amount.toLocaleString()}
                </p>
              </div>
              
              <div className={`border rounded-lg p-4 ${
                darkMode ? 'border-gray-700' : 'border-gray-200'
              }`}>
                <h3 className={`font-semibold mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  Book Information
                </h3>
                <p className={`mb-1 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  <span className="font-medium">Title:</span> {paymentDetails.bookName}
                </p>
                <p className={`mb-1 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  <span className="font-medium">Price:</span> ‚Ç¶{paymentDetails.amount.toLocaleString()}
                </p>
                <p className={`mt-3 text-sm ${
                  darkMode ? 'text-gray-400' : 'text-gray-600'
                }`}>
                  After payment, please send proof and book name as narration to:
                </p>
                <p className="text-blue-500">{paymentDetails.email}</p>
                <p className={`text-sm mt-2 ${
                  darkMode ? 'text-gray-400' : 'text-gray-600'
                }`}>
                  Or via WhatsApp: {paymentDetails.whatsapp}
                </p>
              </div>
            </div>
            
            <form onSubmit={handleSubmit}>
              <div className="mb-4">
                <label className={`block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  Upload Payment Proof
                </label>
                <input
                  type="file"
                  accept="image/*, .pdf"
                  onChange={handleFileChange}
                  className={`w-full p-3 rounded-lg border ${
                    darkMode ? 'border-gray-700 bg-gray-900 text-white' : 'border-gray-300'
                  }`}
                  required
                />
              </div>
              
              <div className="mb-4">
                <label className={`block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  Transaction Reference (Optional)
                </label>
                <input
                  type="text"
                  className={`w-full p-3 rounded-lg border ${
                    darkMode ? 'border-gray-700 bg-gray-900 text-white' : 'border-gray-300'
                  }`}
                  placeholder="Enter reference number if available"
                />
              </div>
              
              <button
                type="submit"
                className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-colors"
              >
                Submit Payment Proof
              </button>
            </form>
          </div>
        )}
        
        <div className="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative mb-6">
          <p className="font-bold">Important Notice</p>
          <p>Your book access will be activated after manual verification of your payment proof. This usually takes less than 24 hours.</p>
        </div>
      </div>
    </div>
  );
};

// Dashboard Page
const Dashboard = () => {
  const { darkMode } = useTheme();
  const { user, logout } = useAuth();
  const location = useLocation();
  const navigate = useNavigate();
  
  const menuItems = [
    { path: 'profile', label: 'My Profile', icon: 'üë§' },
    { path: 'inbox', label: 'Inbox', icon: 'üì•' },
    { path: 'notification', label: 'Notification', icon: 'üîî' },
    { path: 'library', label: 'Library', icon: 'üìö' },
    { path: 'language', label: 'Language', icon: 'üåê' },
    { path: 'payments', label: 'Payments', icon: 'üí≥' },
    { path: 'premium', label: 'Premium', icon: '‚≠ê' },
    { path: 'settings', label: 'Settings', icon: '‚öôÔ∏è' },
    { path: 'help', label: 'Help', icon: '‚ùì' },
  ];

  return (
    <div className="container mx-auto px-4 py-8">
      <Header />
      
      <div className="flex flex-col md:flex-row mt-8 gap-6">
        {/* Sidebar */}
        <div className={`w-full md:w-64 rounded-xl p-4 ${darkMode ? 'bg-gray-800' : 'bg-gray-100'}`}>
          <div className="mb-6">
            <h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-black'}`}>Dashboard</h2>
            <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Welcome, {user?.username}</p>
          </div>
          
          <nav>
            <ul className="space-y-2">
              {menuItems.map(item => (
                <li key={item.path}>
                  <button
                    onClick={() => navigate(`/dashboard/${item.path}`)}
                    className={`flex items-center w-full px-3 py-2 rounded-lg transition-colors ${
                      location.pathname.includes(item.path) 
                        ? 'bg-blue-600 text-white' 
                        : darkMode 
                          ? 'hover:bg-gray-700 text-gray-300' 
                          : 'hover:bg-gray-200 text-gray-700'
                    }`}
                  >
                    <span className="mr-3">{item.icon}</span>
                    {item.label}
                  </button>
                </li>
              ))}
              
              <li>
                <button
                  onClick={logout}
                  className={`flex items-center w-full px-3 py-2 rounded-lg transition-colors ${
                    darkMode ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200 text-gray-700'
                  }`}
                >
                  <span className="mr-3">üö™</span>
                  Logout
                </button>
              </li>
            </ul>
          </nav>
        </div>
        
        {/* Main Content */}
        <div className="flex-1">
          <Routes>
            <Route path="profile" element={<Profile />} />
            <Route path="inbox" element={<Inbox />} />
            <Route path="notification" element={<NotificationSettings />} />
            <Route path="library" element={<Library />} />
            <Route path="language" element={<LanguageSettings />} />
            <Route path="payments" element={<Payments />} />
            <Route path="premium" element={<Premium />} />
            <Route path="settings" element={<Settings />} />
            <Route path="help" element={<HelpAssistant />} />
            <Route index element={<Profile />} />
          </Routes>
        </div>
      </div>
    </div>
  );
};

// Dashboard Components
const Profile = () => {
  const { darkMode } = useTheme();
  const [name, setName] = useState('');
  const [username, setUsername] = useState('');
  const [email, setEmail] = useState('');
  const [bio, setBio] = useState('');

  useEffect(() => {
    // Simulate loading user data
    setTimeout(() => {
      setName('Samuel Alake');
      setUsername('samcreation');
      setEmail('samcreation804@gmail.com');
      setBio('Book lover and knowledge seeker');
    }, 500);
  }, []);

  return (
    <div className={`rounded-xl shadow-md p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
      <h2 className={`text-2xl font-bold mb-6 ${darkMode ? 'text-white' : 'text-black'}`}>
        My Profile
      </h2>
      
      <div className="flex flex-col md:flex-row gap-8">
        <div className="md:w-1/3">
          <div className="bg-gray-200 border-2 border-dashed rounded-xl w-48 h-48 mx-auto" />
          <button className="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg">
            Change Profile Picture
          </button>
        </div>
        
        <div className="md:w-2/3">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
              <label className={`block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                Full Name
              </label>
              <input
                type="text"
                value={name}
                onChange={(e) => setName(e.target.value)}
                className={`w-full p-3 rounded-lg border ${
                  darkMode ? 'border-gray-700 bg-gray-900 text-white' : 'border-gray-300'
                }`}
              />
            </div>
            
            <div>
              <label className={`block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                Username
              </label>
              <input
                type="text"
                value={username}
                onChange={(e) => setUsername(e.target.value)}
                className={`w-full p-3 rounded-lg border ${
                  darkMode ? 'border-gray-700 bg-gray-900 text-white' : 'border-gray-300'
                }`}
              />
            </div>
            
            <div>
              <label className={`block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                Email
              </label>
              <input
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className={`w-full p-3 rounded-lg border ${
                  darkMode ? 'border-gray-700 bg-gray-900 text-white' : 'border-gray-300'
                }`}
              />
            </div>
          </div>
          
          <div className="mb-6">
            <label className={`block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
              Bio
            </label>
            <textarea
              value={bio}
              onChange={(e) => setBio(e.target.value)}
              rows="4"
              className={`w-full p-3 rounded-lg border ${
                darkMode ? 'border-gray-700 bg-gray-900 text-white' : 'border-gray-300'
              }`}
            ></textarea>
          </div>
          
          <button className="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg">
            Save Changes
          </button>
        </div>
      </div>
    </div>
  );
};

const Library = () => {
  const { darkMode } = useTheme();
  
  // Get purchased books from localStorage
  const purchasedBooks = JSON.parse(localStorage.getItem('purchasedBooks') || []);
  
  // Mock book data
  const books = [
    {
      id: '1',
      title: 'The Main Reality Of Life',
      author: 'Samuel A.O.',
      lastRead: '2023-10-15',
      progress: 42
    }
  ].filter(book => purchasedBooks.includes(book.id));

  const [isOffline, setIsOffline] = useState(!navigator.onLine);

  return (
    <div className={`rounded-xl shadow-md p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
      <h2 className={`text-2xl font-bold mb-6 ${darkMode ? 'text-white' : 'text-black'}`}>
        My Library
      </h2>
      
      {isOffline && (
        <div className="bg-yellow-500 text-black p-3 rounded-lg mb-6">
          You are currently offline. Only downloaded books are available.
        </div>
      )}
      
      {books.length === 0 ? (
        <div className="text-center py-12">
          <p className={`mb-4 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
            You haven't purchased any books yet.
          </p>
          <button 
            onClick={() => navigate('/')}
            className="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg"
          >
            Browse Books
          </button>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {books.map(book => (
            <div key={book.id} className={`border rounded-lg p-4 flex ${
              darkMode ? 'border-gray-700' : 'border-gray-200'
            }`}>
              <div className="w-24 flex-shrink-0">
                <div className="bg-gray-200 border-2 border-dashed rounded-xl w-full h-32" />
              </div>
              
              <div className="ml-4 flex-1">
                <h3 className={`font-bold text-lg ${darkMode ? 'text-white' : 'text-black'}`}>
                  {book.title}
                </h3>
                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                  By {book.author}
                </p>
                
                <div className="mt-4">
                  <div className="flex items-center justify-between mb-1">
                    <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                      Progress: {book.progress}%
                    </span>
                    <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                      Last read: {book.lastRead}
                    </span>
                  </div>
                  <div className={`w-full rounded-full h-2 ${
                    darkMode ? 'bg-gray-700' : 'bg-gray-200'
                  }`}>
                    <div 
                      className="bg-blue-600 h-2 rounded-full" 
                      style={{ width: `${book.progress}%` }}
                    ></div>
                  </div>
                </div>
                
                <div className="mt-4">
                  <button 
                    onClick={() => navigate(`/book/${book.id}`)}
                    className="bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-4 rounded-lg mr-2"
                  >
                    Continue Reading
                  </button>
                  <button className={`text-sm font-medium py-2 px-4 rounded-lg ${
                    darkMode 
                      ? 'bg-gray-700 hover:bg-gray-600 text-white' 
                      : 'bg-gray-200 hover:bg-gray-300'
                  }`}>
                    Download
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

// Other dashboard components would be defined similarly

// ======================
// Main App Component
// ======================

const App = () => {
  return (
    <AuthProvider>
      <ThemeProvider>
        <Router>
          <Routes>
            <Route path="/" element={<HomePage />} />
            <Route path="/login" element={<LoginPage />} />
            <Route path="/signup" element={<SignupPage />} />
            <Route path="/book/:id" element={<BookReader />} />
            <Route path="/payment" element={<PaymentPage />} />
            <Route path="/dashboard/*" element={<Dashboard />} />
          </Routes>
        </Router>
      </ThemeProvider>
    </AuthProvider>
  );
};

// ======================
// Render the Application
// ======================

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
